<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Wall</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="wall-mode">

    <div id="communication-wall">
        <div class="light-unit red" id="unit-A"><div class="light-bulb" id="light-A"></div><div class="letter">A</div></div>
        <div class="light-unit red" id="unit-B"><div class="light-bulb" id="light-B"></div><div class="letter">B</div></div>
        <div class="light-unit red" id="unit-C"><div class="light-bulb" id="light-C"></div><div class="letter">C</div></div>
        <div class="light-unit red" id="unit-D"><div class="light-bulb" id="light-D"></div><div class="letter">D</div></div>
        <div class="light-unit red" id="unit-E"><div class="light-bulb" id="light-E"></div><div class="letter">E</div></div>
        <div class="light-unit red" id="unit-F"><div class="light-bulb" id="light-F"></div><div class="letter">F</div></div>
        <div class="light-unit red" id="unit-G"><div class="light-bulb" id="light-G"></div><div class="letter">G</div></div>
        <div class="light-unit red" id="unit-H"><div class="light-bulb" id="light-H"></div><div class="letter">H</div></div>
        
        <div class="light-unit red" id="unit-I"><div class="light-bulb" id="light-I"></div><div class="letter">I</div></div>
        <div class="light-unit red" id="unit-J"><div class="light-bulb" id="light-J"></div><div class="letter">J</div></div>
        <div class="light-unit red" id="unit-K"><div class="light-bulb" id="light-K"></div><div class="letter">K</div></div>
        <div class="light-unit red" id="unit-L"><div class="light-bulb" id="light-L"></div><div class="letter">L</div></div>
        <div class="light-unit red" id="unit-M"><div class="light-bulb" id="light-M"></div><div class="letter">M</div></div>
        <div class="light-unit red" id="unit-N"><div class="light-bulb" id="light-N"></div><div class="letter">N</div></div>
        <div class="light-unit red" id="unit-O"><div class="light-bulb" id="light-O"></div><div class="letter">O</div></div>
        <div class="light-unit red" id="unit-P"><div class="light-bulb" id="light-P"></div><div class="letter">P</div></div>
        <div class="light-unit red" id="unit-Q"><div class="light-bulb" id="light-Q"></div><div class="letter">Q</div></div>
        
        <div class="light-unit red" id="unit-R"><div class="light-bulb" id="light-R"></div><div class="letter">R</div></div>
        <div class="light-unit red" id="unit-S"><div class="light-bulb" id="light-S"></div><div class="letter">S</div></div>
        <div class="light-unit red" id="unit-T"><div class="light-bulb" id="light-T"></div><div class="letter">T</div></div>
        <div class="light-unit red" id="unit-U"><div class="light-bulb" id="light-U"></div><div class="letter">U</div></div>
        <div class="light-unit red" id="unit-V"><div class="light-bulb" id="light-V"></div><div class="letter">V</div></div>
        <div class="light-unit red" id="unit-W"><div class="light-bulb" id="light-W"></div><div class="letter">W</div></div>
        <div class="light-unit red" id="unit-X"><div class="light-bulb" id="light-X"></div><div class="letter">X</div></div>
        <div class="light-unit red" id="unit-Y"><div class="light-bulb" id="light-Y"></div><div class="letter">Y</div></div>
        <div class="light-unit red" id="unit-Z"><div class="light-bulb" id="light-Z"></div><div class="letter">Z</div></div>
    </div>

    <audio id="ambient-hum-audio" loop><source src="electricity-humming.mp3"></audio>
    <audio id="static-flash-audio"><source src="electric-static.mp3"></audio>

    <script>
        const socket = io();
        const wallContainer = document.getElementById('communication-wall');
        const ambientHum = document.getElementById('ambient-hum-audio');
        const staticFlash = document.getElementById('static-flash-audio');

        // Enable Audio on first click
        document.body.addEventListener('click', () => {
            if (ambientHum) ambientHum.play().catch(e => {});
        });

        // ------------------------------------------
        // 1. LISTEN FOR NORMAL MESSAGES
        // ------------------------------------------
        socket.on('flash_wall', (text) => {
            console.log("Wall received:", text);
            spellMessage(text.toUpperCase());
        });

        // ------------------------------------------
        // 2. LISTEN FOR CODE RED (The Trap)
        // ------------------------------------------
        socket.on('execute_order_66', () => {
            console.log("ðŸš¨ CODE RED! Chaos starting...");
            
            // A. Make lights flicker fast (Chaos)
            chaosFlash();

            // B. Wait 3 seconds, then Redirect to Vecna
            setTimeout(() => {
                console.log("Redirecting to Vecna...");
                window.location.href = "/index.html"; 
            }, 3000);
        });

        // --- ANIMATION FUNCTIONS ---

        function chaosFlash() {
            // Flash random lights every 50ms
            const interval = setInterval(() => {
                // Turn off all current lights
                document.querySelectorAll('.lit').forEach(l => l.classList.remove('lit'));
                
                // Turn on a random new one
                const bulbs = document.querySelectorAll('.light-bulb');
                const random = bulbs[Math.floor(Math.random() * bulbs.length)];
                if(random) random.classList.add('lit');
            }, 50); 
        }

        function spellMessage(text) {
            const chars = text.split('');
            let delay = 0;

            chars.forEach(char => {
                if (char >= 'A' && char <= 'Z') {
                    setTimeout(() => {
                        const bulb = document.getElementById(`light-${char}`);
                        if (bulb) {
                            // Play Sound
                            if (staticFlash) {
                                const sound = staticFlash.cloneNode();
                                sound.volume = 0.5;
                                sound.play().catch(e=>{});
                            }
                            // Light Up
                            bulb.classList.add('lit');
                            setTimeout(() => bulb.classList.remove('lit'), 800);
                        }
                    }, delay);
                    delay += 1200; 
                } else {
                    delay += 500; // Space
                }
            });
        }
    </script>
</body>
</html>